#:include param_slider.kv
#:include separator.kv
#:include spacer.kv
#:include viewer_widget.kv
#:include histogram_widget.kv
#:include metainfo.kv
#:include color_picker.kv
#:include export_dialog.kv
#:include hover_spinner.kv

#:set clear_color 0, 0, 0, 0
#:set dark_color 0.08, 0.08, 0.08, 1

<ParamChip@MDChip>:
    type: 'filter'
    pos_hint: {"center_x": .5, "center_y": .5}
    size_hint: 0.2, None
    ref_height: 20
    radius: 40
    line_color: 'grey'

<ParamChipText@MDChipText>:
    font_size: '9pt'
    color: 'b0b0b0' 

<MainSpinnerOption@SpinnerOption>:
    size_hint_y: None
    height: dp(20)

<ParamSpinner@HoverSpinner>:
    pos_hint: {'center_x': .5, 'center_y': .5}
    size_hint: 0.55, None
    ref_height: 20
    font_size: '9pt'
    #option_cls: "MainSpinnerOption"

<CurveTabbedPanel@TabbedPanel>:
    size_hint: None, None
    width: self.parent.width
    height: self.parent.width
    ref_tab_width: 80
    ref_tab_height: 20
    do_default_tab: False
    on_kv_post: self.switch_to(root.tab_list[0]) if root.tab_list else None

<CurveWidget>:

<MainWidget>:

    BoxLayout:
        orientation: 'vertical'
        size: root.size

        BoxLayout:
            orientation: 'horizontal'
            #size_hint_y: 1

            BoxLayout:
                orientation: 'vertical'
                size_hint_x: 0.3
                margin: dp(8)
                spacing: dp(8)

                HistogramWidget:
                    id: histogram
                    size_hint: 1, 0.2
                    canvas:
                        Color:
                            rgba: dark_color
                        Rectangle:
                            size: self.size
                            pos: self.pos                    

                MDScrollView:
                    size_hint: 1, 0.8

                    BoxLayout:
                        size_hint_y: None
                        orientation: "vertical"
                        height: self.minimum_height

                        MetaInfo:
                            id: exif_file_name
                            key: "File Name"
                        MetaInfo:
                            id: exif_file_size
                            key: "File Size"
                        MetaInfo:
                            id: exif_create_date
                            key: "Create Date"
                        MetaInfo:
                            id: exif_image_size
                            key: "Image Size"
                        MetaInfo:
                            id: exif_iso_speed
                            key: "ISO Speed"
                        MetaInfo:
                            id: exif_aperture
                            key: "Aperture"
                        MetaInfo:
                            id: exif_shutter_speed
                            key: "Shutter Speed"
                        MetaInfo:
                            id: exif_brightness
                            key: "Brightness"
                        MetaInfo:
                            id: exif_flash
                            key: "Flash"
                        MetaInfo:
                            id: exif_white_balance
                            key: "White Balance"
                        MetaInfo:
                            id: exif_focal_length
                            key: "Focal Length"
                        MetaInfo:
                            id: exif_exposure_program
                            key: "Exposure Program"
                        MetaInfo:
                            id: exif_make
                            key: "Make"
                        MetaInfo:
                            id: exif_model
                            key: "Model"
                        MetaInfo:
                            id: exif_lens_model
                            key: "Lens Model"
                        MetaInfo:
                            id: exif_software
                            key: "Software"
                            
            BoxLayout:
                orientation: 'vertical'
                size_hint_x: 0.7

                FloatLayout:
                    id: preview_widget
                    pos_hint: {'x':0, 'y': 0}
                    size_hint_y: 0.95
                    on_touch_down: root.on_image_touch_down(args[1])
                    on_touch_move: root.on_image_touch_move(args[1])
                    on_touch_up: root.on_image_touch_up(args[1])
               
                    Image:
                        id: preview
                        pos_hint: {'x':0, 'y': 0}
                        canvas:
                            Color:
                                rgba: dark_color if not self.texture else clear_color
                            Rectangle:
                                pos: self.pos
                                size: self.size
 
                    MaskEditor2:
                        id: mask_editor2
                        root: root
                        pos_hint: {'x':0, 'top': 1}
                        canvas.before:
                            Color:
                                rgba: clear_color
                            Rectangle:
                                size: self.size
                                pos: self.pos

                BoxLayout:
                    orientation: 'horizontal'
                    size_hint_y: 0.05

                    Button:
                        size_hint_x: 0.1
                        text: "select"
                        on_press: root.on_select_press()
                    HSpacer:
                        size_hint_x: 0.7
                    ToggleButton:
                        id: mask2
                        size_hint_x: 0.1
                        text: "mask2"
                        on_state: root.on_mask2_press(self.state)
                        on_state: geometry.disabled = True if mask2.state == 'down' else False
                    Button:
                        size_hint_x: 0.1
                        text: "export"
                        on_press: root.on_export_press()


            TabbedPanel:
                id: effects
                size_hint_x: 0.4
                do_default_tab: False
                tab_width: self.width * 0.2
                tab_height: self.height * 0.05
                on_current_tab: root.on_current_tab(self.current_tab)
                on_current_tab: mask2.disabled = self.current_tab.text == "Geometry"

                TabbedPanelItem:
                    text: 'Basic'

                    MDScrollView:

                        BoxLayout:
                            size_hint_y: None
                            orientation: "vertical"
                            height: self.minimum_height

                            HeadLabel:
                                text: ' White Balance'
 
                            ParamSlider:
                                id: slider_color_temperature
                                text: "Temperature"
                                min: 2000
                                max: 12000
                                value: 5000
                                step: 10
                                on_slider: root.apply_effects_lv(2, 'color_temperature')

                            ParamSlider:
                                id: slider_color_tint
                                text: "Tint"
                                min: -100
                                max: 100
                                value: 0
                                step: 1
                                on_slider: root.apply_effects_lv(2, 'color_temperature')

                            VSeparator:
 
                            HeadLabel:
                                text: ' Tone'

                            ParamSlider:
                                id: slider_exposure
                                text: "Exposure"                            
                                min: -4.0
                                max: 4.0
                                value: 0.0
                                step: 0.05
                                for_float: True
                                on_slider: root.apply_effects_lv(2, 'exposure')

                            ParamSlider:
                                id: slider_contrast
                                text: "Contrast"
                                min: -100
                                max: 100
                                value: 0
                                step: 1
                                on_slider: root.apply_effects_lv(2, 'contrast')

                            ParamSlider:
                                id: slider_midtone
                                text: "Midtone"                            
                                min: -100
                                max: 100
                                value: 0
                                step: 1
                                on_slider: root.apply_effects_lv(2, 'tone')

                            VSeparator:

                            ParamSlider:
                                id: slider_highlight
                                text: "Highlights"
                                min: -100
                                max: 100
                                value: 0
                                step: 1
                                on_slider: root.apply_effects_lv(2, 'tone')

                            ParamSlider:
                                id: slider_shadow
                                text: "Shadows"
                                min: -100
                                max: 100
                                value: 0
                                step: 1
                                on_slider: root.apply_effects_lv(2, 'tone')

                            ParamSlider:
                                id: slider_white
                                text: "Whites"
                                min: -100
                                max: 100
                                value: 0
                                step: 1
                                on_slider: root.apply_effects_lv(2, 'tone')

                            ParamSlider:
                                id: slider_black
                                text: "Blacks"
                                min: -100
                                max: 100
                                value: 0
                                step: 1
                                on_slider: root.apply_effects_lv(2, 'tone')

                            VSeparator:
                            
                            HeadLabel:
                                text: ' Precence'

                            ParamSlider:
                                id: slider_clarity
                                text: "Clarity"
                                min: -100
                                max: 100
                                value: 0
                                step: 1
                                on_slider: root.apply_effects_lv(2, 'clarity')

                            ParamSlider:
                                id: slider_texture
                                text: "Texture"
                                min: -100
                                max: 100
                                value: 0
                                step: 1
                                on_slider: root.apply_effects_lv(2, 'texture')

                            ParamSlider:
                                id: slider_microcontrast
                                text: "Micro Contrast"
                                min: -100
                                max: 100
                                value: 0
                                step: 1
                                on_slider: root.apply_effects_lv(2, 'microcontrast')

                            ParamSlider:
                                id: slider_dehaze
                                text: "Dehaze"
                                min: -100
                                max: 100
                                value: 0
                                step: 1
                                on_slider: root.apply_effects_lv(2, 'dehaze')

                            ParamSlider:
                                id: slider_clahe_intensity
                                text: "CLAHE"
                                min: 0
                                max: 100
                                value: 0
                                step: 1
                                on_slider: root.apply_effects_lv(2, 'clahe')

                            VSeparator:
                            
                            ParamSlider:
                                text: "Saturation"
                                id: slider_saturation
                                min: -100
                                max: 100
                                value: 0
                                step: 1
                                on_slider: root.apply_effects_lv(2, 'vs_and_saturation')

                            ParamSlider:
                                text: "Vibrance"
                                id: slider_vibrance
                                min: -100
                                max: 100
                                value: 0
                                step: 1
                                on_slider: root.apply_effects_lv(2, 'vs_and_saturation')

                            VSeparator:
                                                        
                            HeadLabel:
                                text: ' Color Mixer'

                            TabbedPanel:
                                size_hint_y: None
                                ref_height: 22*3+20+22+6
                                ref_tab_width: 60
                                ref_tab_height: 20
                                do_default_tab: False

                                TabbedPanelItem:
                                    text: 'Red'

                                    BoxLayout:
                                        size_hint_y: None
                                        orientation: "vertical"
                                        height: self.minimum_height
                                        HeadLabel:
                                            text: ' Red'
                                        ParamSlider:
                                            id: slider_hls_red_hue
                                            text: "Hue"
                                            min: -180
                                            max: 180
                                            value: 0
                                            step: 1
                                            on_slider: root.apply_effects_lv(2, 'hls')
                                        ParamSlider:
                                            id: slider_hls_red_lum
                                            text: "Luminance"
                                            min: -100
                                            max: 100
                                            value: 0
                                            step: 1
                                            on_slider: root.apply_effects_lv(2, 'hls')
                                        ParamSlider:
                                            id: slider_hls_red_sat
                                            text: "Saturation"
                                            min: -100
                                            max: 100
                                            value: 0
                                            step: 1
                                            on_slider: root.apply_effects_lv(2, 'hls')
                    
                                TabbedPanelItem:
                                    text: 'Orange'

                                    BoxLayout:
                                        size_hint_y: None
                                        orientation: "vertical"
                                        height: self.minimum_height
                                        HeadLabel:
                                            text: ' Orange'
                                        ParamSlider:
                                            id: slider_hls_orange_hue
                                            text: "Hue"
                                            min: -180
                                            max: 180
                                            value: 0
                                            step: 1
                                            on_slider: root.apply_effects_lv(2, 'hls')
                                        ParamSlider:
                                            id: slider_hls_orange_lum
                                            text: "Luminance"
                                            min: -100
                                            max: 100
                                            value: 0
                                            step: 1
                                            on_slider: root.apply_effects_lv(2, 'hls')
                                        ParamSlider:
                                            id: slider_hls_orange_sat
                                            text: "Saturation"
                                            min: -100
                                            max: 100
                                            value: 0
                                            step: 1
                                            on_slider: root.apply_effects_lv(2, 'hls')

                                TabbedPanelItem:
                                    text: 'Yellow'

                                    BoxLayout:
                                        size_hint_y: None
                                        orientation: "vertical"
                                        height: self.minimum_height
                                        HeadLabel:
                                            text: ' Yellow'
                                        ParamSlider:
                                            id: slider_hls_yellow_hue
                                            text: "hue"
                                            min: -180
                                            max: 180
                                            value: 0
                                            step: 1
                                            on_slider: root.apply_effects_lv(2, 'hls')
                                        ParamSlider:
                                            id: slider_hls_yellow_lum
                                            text: "Luminance"
                                            min: -100
                                            max: 100
                                            value: 0
                                            step: 1
                                            on_slider: root.apply_effects_lv(2, 'hls')
                                        ParamSlider:
                                            id: slider_hls_yellow_sat
                                            text: "Saturation"
                                            min: -100
                                            max: 100
                                            value: 0
                                            step: 1
                                            on_slider: root.apply_effects_lv(2, 'hls')

                                TabbedPanelItem:
                                    text: 'Green'

                                    BoxLayout:
                                        size_hint_y: None
                                        orientation: "vertical"
                                        height: self.minimum_height
                                        HeadLabel:
                                            text: ' Green'
                                        ParamSlider:
                                            id: slider_hls_green_hue
                                            text: "Hue"
                                            min: -180
                                            max: 180
                                            value: 0
                                            step: 1
                                            on_slider: root.apply_effects_lv(2, 'hls')
                                        ParamSlider:
                                            id: slider_hls_green_lum
                                            text: "Luminance"
                                            min: -100
                                            max: 100
                                            value: 0
                                            step: 1
                                            on_slider: root.apply_effects_lv(2, 'hls')
                                        ParamSlider:
                                            id: slider_hls_green_sat
                                            text: "Saturation"
                                            min: -100
                                            max: 100
                                            value: 0
                                            step: 1
                                            on_slider: root.apply_effects_lv(2, 'hls')

                                TabbedPanelItem:
                                    text: 'Cyan'

                                    BoxLayout:
                                        size_hint_y: None
                                        orientation: "vertical"
                                        height: self.minimum_height
                                        HeadLabel:
                                            text: ' Cyan'
                                        ParamSlider:
                                            id: slider_hls_cyan_hue
                                            text: "Hue"
                                            min: -180
                                            max: 180
                                            value: 0
                                            step: 1
                                            on_slider: root.apply_effects_lv(2, 'hls')
                                        ParamSlider:
                                            id: slider_hls_cyan_lum
                                            text: "Luminance"
                                            min: -100
                                            max: 100
                                            value: 0
                                            step: 1
                                            on_slider: root.apply_effects_lv(2, 'hls')
                                        ParamSlider:
                                            id: slider_hls_cyan_sat
                                            text: "Saturation"
                                            min: -100
                                            max: 100
                                            value: 0
                                            step: 1
                                            on_slider: root.apply_effects_lv(2, 'hls')

                                TabbedPanelItem:
                                    text: 'Blue'

                                    BoxLayout:
                                        size_hint_y: None
                                        orientation: "vertical"
                                        height: self.minimum_height
                                        HeadLabel:
                                            text: ' Blue'
                                        ParamSlider:
                                            id: slider_hls_blue_hue
                                            text: "Hue"
                                            min: -180
                                            max: 180
                                            value: 0
                                            step: 1
                                            on_slider: root.apply_effects_lv(2, 'hls')
                                        ParamSlider:
                                            id: slider_hls_blue_lum
                                            text: "Luminance"
                                            min: -100
                                            max: 100
                                            value: 0
                                            step: 1
                                            on_slider: root.apply_effects_lv(2, 'hls')
                                        ParamSlider:
                                            id: slider_hls_blue_sat
                                            text: "Saturation"
                                            min: -100
                                            max: 100
                                            value: 0
                                            step: 1
                                            on_slider: root.apply_effects_lv(2, 'hls')

                                TabbedPanelItem:
                                    text: 'Purple'

                                    BoxLayout:
                                        size_hint_y: None
                                        orientation: "vertical"
                                        height: self.minimum_height
                                        HeadLabel:
                                            text: ' Purple'
                                        ParamSlider:
                                            id: slider_hls_purple_hue
                                            text: "Hue"
                                            min: -180
                                            max: 180
                                            value: 0
                                            step: 1
                                            on_slider: root.apply_effects_lv(2, 'hls')
                                        ParamSlider:
                                            id: slider_hls_purple_lum
                                            text: "Luminance"
                                            min: -100
                                            max: 100
                                            value: 0
                                            step: 1
                                            on_slider: root.apply_effects_lv(2, 'hls')
                                        ParamSlider:
                                            id: slider_hls_purple_sat
                                            text: "Saturation"
                                            min: -100
                                            max: 100
                                            value: 0
                                            step: 1
                                            on_slider: root.apply_effects_lv(2, 'hls')

                                TabbedPanelItem:
                                    text: 'Magenta'

                                    BoxLayout:
                                        size_hint_y: None
                                        orientation: "vertical"
                                        height: self.minimum_height
                                        HeadLabel:
                                            text: ' Magenta'
                                        ParamSlider:
                                            id: slider_hls_magenta_hue
                                            text: "Hue"
                                            min: -180
                                            max: 180
                                            value: 0
                                            step: 1
                                            on_slider: root.apply_effects_lv(2, 'hls')
                                        ParamSlider:
                                            id: slider_hls_magenta_lum
                                            text: "Luminance"
                                            min: -100
                                            max: 100
                                            value: 0
                                            step: 1
                                            on_slider: root.apply_effects_lv(2, 'hls')
                                        ParamSlider:
                                            id: slider_hls_magenta_sat
                                            text: "Saturation"
                                            min: -100
                                            max: 100
                                            value: 0
                                            step: 1
                                            on_slider: root.apply_effects_lv(2, 'hls')

                            VSeparator:
 
                            HeadLabel:
                                text: ' Vignette'

                            ParamSlider:
                                id: slider_vignette_intensity
                                text: "Intensity"
                                min: -100
                                max: 100
                                value: 0
                                step: 1
                                on_slider: root.apply_effects_lv(4, 'vignette')

                            ParamSlider:
                                id: slider_vignette_radius_percent
                                text: "Radius"
                                min: 0
                                max: 100
                                value: 0
                                step: 1
                                on_slider: root.apply_effects_lv(4, 'vignette')

                            VSeparator:
 
                            HeadLabel:
                                text: ' Exception'

                            ParamBoxLayout:
                                ParamLabel:
                                    text: "Highlight"
                                VSpacer:
                                    size_hint_x: 0.45
                                ParamChip:
                                    id: switch_highlight_compress
                                    active: False
                                    on_active: root.apply_effects_lv(2, 'highlight_compress')
                                    ParamChipText:
                                        text: "Compress"

                            ParamBoxLayout:
                                ParamLabel:
                                    text: "Overexposed"
                                VSpacer:
                                    size_hint_x: 0.45
                                ParamChip:
                                    id: switch_correct_overexposed_areas
                                    on_active: root.apply_effects_lv(3, 'correct_overexposed_areas')
                                    ParamChipText:
                                        text: "Correct"

                            ParamSlider:
                                id: slider_correct_overexposed_areas_blur
                                text: "Blur"
                                min: 0
                                max: 100
                                value: 0
                                step: 1
                                on_slider: root.apply_effects_lv(3, 'correct_overexposed_areas')
                            
                            VSpacer:

                            BoxLayout:
                                size_hint_y: None
                                orientation: "vertical"
                                height: self.minimum_height
                                
                                CWColorPicker:
                                    id: cp_correct_overexposed_areas
                                    on_current_color: root.apply_effects_lv(3, 'correct_overexposed_areas')

                TabbedPanelItem:
                    text: 'Curves'

                    MDScrollView:

                        BoxLayout:
                            orientation: "vertical"
                            size_hint_y: None
                            height: self.minimum_height

                            HeadLabel:
                                text: ' Tone Curve'

                            CurveTabbedPanel:
                                default_tab: tab_all

                                TabbedPanelItem:
                                    id: tab_all
                                    text: 'All'

                                    CurveWidget:
                                        id: tonecurve
                                        start_y: 0.0
                                        end_y: 1.0
                                        on_curve: root.apply_effects_lv(2, 'curve')

                                TabbedPanelItem:
                                    text: 'Red'

                                    CurveWidget:
                                        id: tonecurve_red
                                        start_y: 0.0
                                        end_y: 1.0
                                        on_curve: root.apply_effects_lv(2, 'curve')

                                TabbedPanelItem:
                                    text: 'Green'

                                    CurveWidget:
                                        id: tonecurve_green
                                        start_y: 0.0
                                        end_y: 1.0
                                        on_curve: root.apply_effects_lv(2, 'curve')

                                TabbedPanelItem:
                                    text: 'Blue'

                                    CurveWidget:
                                        id: tonecurve_blue
                                        start_y: 0.0
                                        end_y: 1.0
                                        on_curve: root.apply_effects_lv(2, 'curve')
                                
                            VSpacer:
                            
                            HeadLabel:
                                text: ' Color Grading'

                            CurveTabbedPanel:
                                ref_tab_width: 100
                                default_tab: tab_grading1

                                TabbedPanelItem:
                                    id: tab_grading1
                                    text: 'Grading 1'

                                    BoxLayout:
                                        orientation: "vertical"
                                        #size_hint_y: None
                                        #height: self.minimum_height
                                        
                                        CurveWidget:
                                            id: grading1
                                            start_y: 1.0
                                            end_y: 0.0
                                            on_curve: root.apply_effects_lv(2, 'curve')

                                        CWColorPicker:
                                            id: grading1_color_picker
                                            on_current_color: root.apply_effects_lv(2, 'curve')


                                TabbedPanelItem:
                                    text: 'Grading 2'

                                    BoxLayout:
                                        orientation: "vertical"
                                        #size_hint_y: None
                                        #height: self.minimum_height

                                        CurveWidget:
                                            id: grading2
                                            start_y: 0.0
                                            end_y: 1.0
                                            on_curve: root.apply_effects_lv(2, 'curve')

                                        CWColorPicker:
                                            id: grading2_color_picker
                                            on_current_color: root.apply_effects_lv(2, 'curve')
                            
                            VSpacer:
                            
                            CurveTabbedPanel:
                                ref_tab_width: 100
                                default_tab: tab_lum_vs_lum

                                TabbedPanelItem:
                                    id: tab_lum_vs_lum
                                    text: 'Lum vs Lum'

                                    HeadLabel:
                                        text: "Lum vs Lum"
                                    CurveWidget:
                                        id: LumvsLum
                                        start_y: 0.5
                                        end_y: 0.5
                                        on_curve: root.apply_effects_lv(2, 'vs_and_saturation')

                                TabbedPanelItem:
                                    text: 'Hue vs Hue'

                                    HeadLabel:
                                        text: "Hue vs Hue"
                                    CurveWidget:
                                        id: HuevsHue
                                        start_y: 0.5
                                        end_y: 0.5
                                        on_curve: root.apply_effects_lv(2, 'vs_and_saturation')

                                TabbedPanelItem:
                                    text: 'Hue vs Sat'

                                    HeadLabel:
                                        text: "Hue vs Sat"
                                    CurveWidget:
                                        id: HuevsSat
                                        start_y: 0.5
                                        end_y: 0.5
                                        on_curve: root.apply_effects_lv(2, 'vs_and_saturation')

                                TabbedPanelItem:
                                    text: 'Hue vs Lum'

                                    HeadLabel:
                                        text: "Hue vs Lum"
                                    CurveWidget:
                                        id: HuevsLum
                                        start_y: 0.5
                                        end_y: 0.5
                                        on_curve: root.apply_effects_lv(2, 'vs_and_saturation')

                                TabbedPanelItem:
                                    text: 'Lum vs Sat'

                                    HeadLabel:
                                        text: "Lum vs Sat"
                                    CurveWidget:
                                        id: LumvsSat
                                        start_y: 0.5
                                        end_y: 0.5
                                        on_curve: root.apply_effects_lv(2, 'vs_and_saturation')

                                TabbedPanelItem:
                                    text: 'Sat vs Sat'

                                    HeadLabel:
                                        text: "Sat vs Sat"
                                    CurveWidget:
                                        id: SatvsSat
                                        start_y: 0.5
                                        end_y: 0.5
                                        on_curve: root.apply_effects_lv(2, 'vs_and_saturation')

                                TabbedPanelItem:
                                    text: 'Sat vs Lum'

                                    HeadLabel:
                                        text: "Sat vs Lum"
                                    CurveWidget:
                                        id: SatvsLum
                                        start_y: 0.5
                                        end_y: 0.5
                                        on_curve: root.apply_effects_lv(2, 'vs_and_saturation')                            

                TabbedPanelItem:
                    text: 'Extra'

                    MDScrollView:

                        MDBoxLayout:
                            orientation: "vertical"
                            size_hint_y: None
                            height: self.minimum_height

                            HeadLabel:
                                text: ' Noise Reduction'

                            ParamBoxLayout:
                                ParamLabel:
                                    text: "AI"
                                VSpacer:
                                    size_hint_x: 0.55
                                ParamChip:
                                    id: switch_ai_noise_reduction
                                    on_active: root.apply_effects_lv(1, 'ai_noise_reduction')
                                    ParamChipText:
                                        text: "AI"

                            ParamSlider:
                                id: slider_nlm_noise_reduction
                                text: "NLM"
                                min: 0
                                max: 100
                                value: 0
                                step: 1
                                on_slider: root.apply_effects_lv(1, 'nlm_noise_reduction')

                            VSeparator:

                            HeadLabel:
                                text: ' Details'

                            ParamBoxLayout:
                                ParamLabel:
                                    text: "Inpaint"
                                VSpacer:
                                    size_hint_x: 0.25
                                ParamChip:
                                    id: switch_inpaint
                                    on_active: root.apply_effects_lv(0, 'inpaint')
                                    ParamChipText:
                                        text: "Prepare"
                                ParamChip:
                                    type: 'assist'
                                    id: button_inpaint_predict
                                    on_press: root.apply_effects_lv(0, 'inpaint')
                                    ParamChipText:
                                        text: "Erase"
                                ToggleButton:
                                    id: toggle_inpaint_edit
                                    text: "Edit"
                                    on_state: root.on_inpaint_edit_press(self.state)
                                    #on_state: geometry.disabled = True if mask2.state == 'down' else False

                            ParamBoxLayout:
                                ParamLabel:
                                    text: "Defocus"
                                VSpacer:
                                    size_hint_x: 0.55
                                ParamChip:
                                    id: switch_defocus
                                    on_active: root.apply_effects_lv(1, 'defocus')
                                    ParamChipText:
                                        text: "AI"

                            ParamBoxLayout:
                                ParamLabel:
                                    text: "Subpixel shift"
                                VSpacer:
                                    size_hint_x: 0.55
                                ParamChip:
                                    id: switch_subpixel_shift
                                    on_active: root.apply_effects_lv(0, 'subpixel_shift')
                                    ParamChipText:
                                        text: "AI"

                            ParamSlider:
                                id: slider_deblur_filter
                                text: "Deblur"
                                min: 0
                                max: 50
                                value: 0
                                step: 1
                                on_slider: root.apply_effects_lv(1, 'deblur_filter')
                                
                            VSeparator:

                            HeadLabel:
                                text: ' LUT'

                            ParamBoxLayout:
                                ParamLabel:
                                    text: "File"
                                VSpacer:
                                    size_hint_x: 0.12
                                ParamSpinner:
                                    id: lut_spinner
                                    values: [ 'None', ]
                                    #on_text: root.apply_effects_lv(2, 'lut')
                                    on_hovered_item: root.apply_effects_lv(2, 'lut')
                                Button:
                                    pos_hint: {'center_x': .5, 'center_y': .5}
                                    size_hint: 0.08, None
                                    ref_height: 20
                                    on_press: root.on_lut_select_folder()

                            ParamSlider:
                                id: slider_lut_intensity
                                text: "Intensity"
                                min: 0
                                max: 100
                                value: 100
                                step: 1
                                on_slider: root.apply_effects_lv(2, 'lut')

                            VSeparator:

                            HeadLabel:
                                text: ' Film Simulation'

                            ParamBoxLayout:
                                ParamLabel:
                                    text: "Type"
                                VSpacer:
                                    size_hint_x: 0.1
                                ParamSpinner:
                                    id: spinner_film_preset
                                    values: [ 'None', ]
                                    #on_text: root.apply_effects_lv(2, 'film_simulation')
                                    on_hovered_item: root.apply_effects_lv(2, 'film_simulation')
                                    
                            ParamSlider:
                                id: slider_film_intensity
                                text: "Intensity"
                                min: 0
                                max: 100
                                value: 100
                                step: 1
                                on_slider: root.apply_effects_lv(2, 'film_simulation')

                            HeadLabel:
                                text: ' Lens Simulator'

                            ParamBoxLayout:
                                ParamLabel:
                                    text: "Type"
                                VSpacer:
                                    size_hint_x: 0.1
                                ParamSpinner:
                                    id: spinner_lens_preset
                                    values: [ 'None', ]
                                    #on_text: root.apply_effects_lv(2, 'lens_simulator')
                                    on_hovered_item: root.apply_effects_lv(2, 'lens_simulator')
                                    
                            ParamSlider:
                                id: slider_lens_intensity
                                text: "Intensity"
                                min: 0
                                max: 100
                                value: 100
                                step: 1
                                on_slider: root.apply_effects_lv(2, 'lens_simulator')

                            VSeparator:

                            HeadLabel:
                                text: ' Filter'

                            ParamSlider:
                                id: slider_lensblur_filter
                                text: "Lensblur"
                                min: 0
                                max: 100
                                value: 0
                                step: 2
                                on_slider: root.apply_effects_lv(1, 'lensblur_filter')

                            ParamSlider:
                                id: slider_scratch
                                text: "Scratch"
                                min: 0
                                max: 100
                                value: 0
                                step: 1
                                on_slider: root.apply_effects_lv(1, 'scratch')

                            ParamSlider:
                                id: slider_frosted_glass
                                text: "Frosted Glass"
                                min: 0
                                max: 100
                                value: 0
                                step: 1
                                on_slider: root.apply_effects_lv(1, 'frosted_glass')

                            ParamSlider:
                                id: slider_mosaic
                                text: "Mosaic"
                                min: 0
                                max: 100
                                value: 0
                                step: 1
                                on_slider: root.apply_effects_lv(1, 'mosaic')

                            VSeparator:

                            HeadLabel:
                                text: ' Level'

                            ParamSlider:
                                id: slider_black_level
                                text: "Black Level"
                                min: 0
                                max: 253
                                value: 0
                                step: 1
                                on_slider: root.apply_effects_lv(2, 'level')

                            ParamSlider:
                                id: slider_mid_level
                                text: "Mid Level"
                                min: 1
                                max: 254
                                value: 127
                                step: 1
                                on_slider: root.apply_effects_lv(2, 'level')

                            ParamSlider:
                                id: slider_white_level
                                text: "White Level"
                                min: 2
                                max: 255
                                value: 255
                                step: 1
                                on_slider: root.apply_effects_lv(2, 'level')

                            VSeparator:

                            HeadLabel:
                                text: ' Glow Effect'

                            ParamSlider:
                                id: slider_glow_black
                                text: "Black"
                                min: 0
                                max: 126
                                value: 0
                                step: 1
                                on_slider: root.apply_effects_lv(1, 'glow')

                            ParamSlider:
                                id: slider_glow_gauss
                                text: "Gauss"
                                min: 0
                                max: 100
                                value: 0
                                step: 2
                                on_slider: root.apply_effects_lv(1, 'glow')

                            ParamSlider:
                                id: slider_glow_opacity
                                text: "Opacity"
                                min: 0
                                max: 100
                                value: 0
                                step: 1
                                on_slider: root.apply_effects_lv(1, 'glow')

                TabbedPanelItem:
                    id: geometry
                    text: 'Geometry'

                    MDScrollView:

                        MDBoxLayout:
                            orientation: "vertical"
                            size_hint_y: None
                            height: self.minimum_height

                            HeadLabel:
                                text: ' Rotation'

                            ParamSlider:
                                id: slider_rotation
                                text: "Angle"
                                min: -45.0
                                max: 45.0
                                value: 0
                                step: 1
                                on_slider: root.apply_effects_lv(0, 'rotation')
                                on_slider: root.apply_effects_lv(0, 'crop')

                            VSpacer:
                            
                            ParamBoxLayout:

                                HSpacer:
                                    ref_width: 100
                                Button:
                                    pos_hint: {'center_x': .5, 'center_y': .5}
                                    ref_height: 20
                                    text: "L"
                                    on_press: root.apply_effects_lv(0, 'crop')
                                    on_press: root.set_effect_param(0, 'rotation', 90)
                                Button:
                                    pos_hint: {'center_x': .5, 'center_y': .5}
                                    ref_height: 20
                                    text: "R"
                                    on_press: root.apply_effects_lv(0, 'crop')
                                    on_press: root.set_effect_param(0, 'rotation', -90)
                                Button:
                                    pos_hint: {'center_x': .5, 'center_y': .5}
                                    ref_height: 20
                                    text: "H"
                                    on_press: root.apply_effects_lv(0, 'crop')
                                    on_press: root.set_effect_param(0, 'rotation', 'hflip')
                                Button:
                                    pos_hint: {'center_x': .5, 'center_y': .5}
                                    ref_height: 20
                                    text: "V"
                                    on_press: root.apply_effects_lv(0, 'crop')
                                    on_press: root.set_effect_param(0, 'rotation', 'vflip')

                            VSeparator:

                            HeadLabel:
                                text: " Crop"

                            ParamBoxLayout:
                                ParamLabel:
                                    text: "Crop"
                                HSpacer:
                                    size_hint_x: 0.5
                                ParamChip:
                                    type: 'assist'
                                    id: button_crop_reset
                                    on_press: root.apply_effects_lv(0, 'crop')
                                    ParamChipText:
                                        text: "Reset"
                                    
                            ParamBoxLayout:
                                ParamLabel:
                                    text: "Aspect Ratio"
                                HSpacer:
                                    size_hint_x: 0.15
                                ParamSpinner:
                                    id: spinner_acpect_ratio
                                    values: ["None", "1 / 1", "5 / 4", "3 / 2", "4 / 3", "16 / 9", "1.414 / 1", "148 / 100"]
                                    on_text: root.apply_effects_lv(0, 'crop')

                TabbedPanelItem:
                    text: 'Mask2'

                    MDScrollView:

                        MDBoxLayout:
                            orientation: "vertical"
                            size_hint_y: None
                            height: self.minimum_height

                            HeadLabel:
                                text: ' Hue'
                            ParamSlider:
                                id: slider_mask2_hue_distance
                                text: "Distance"
                                min: 0
                                max: 359
                                value: 359
                                step: 1
                                on_slider: root.apply_effects_lv(3, 'mask2')

                            HeadLabel:
                                text: ' Lum'
                            ParamSlider:
                                id: slider_mask2_lum_min
                                text: "Min"
                                min: 0
                                max: 255
                                value: 0
                                step: 1
                                on_slider: root.apply_effects_lv(3, 'mask2')
                            ParamSlider:
                                id: slider_mask2_lum_max
                                text: "Max"
                                min: 0
                                max: 255
                                value: 255
                                step: 1
                                on_slider: root.apply_effects_lv(3, 'mask2')

                            HeadLabel:
                                text: ' Sat'
                            ParamSlider:
                                id: slider_mask2_sat_min
                                text: "Min"
                                min: 0
                                max: 255
                                value: 0
                                step: 1
                                on_slider: root.apply_effects_lv(3, 'mask2')
                            ParamSlider:
                                id: slider_mask2_sat_max
                                text: "Max"
                                min: 0
                                max: 255
                                value: 255
                                step: 1
                                on_slider: root.apply_effects_lv(3, 'mask2')

                            VSeparator:

                            ParamSlider:
                                id: slider_mask2_blur
                                text: "Blur"
                                min: 0
                                max: 100
                                value: 0
                                step: 2
                                on_slider: root.apply_effects_lv(3, 'mask2')

        ViewerWidget:
            id: viewer
            size_hint_y: None
            ref_height: 160
            grid_width: 100
            on_last_selected: root.on_select(self.last_selected)

