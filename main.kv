#:include param_slider.kv
#:include separator.kv
#:include spacer.kv
#:include viewer_widget.kv

MainWidget:   

<MainWidget>:
    
    BoxLayout:
        orientation: 'vertical'
        size: root.size

        BoxLayout:
            orientation: 'horizontal'
            size_hint_y: 9

            BoxLayout:
                id: info
                orientation: 'vertical'
                size_hint_x: 1

                Label:
                    text: "Info"
            
            RelativeLayout:
                id: preview_widget
                size_hint_x: 6
                Image:
                    pos: [0, 0]
                    id: preview

            TabbedPanel:
                size: 700, 0
                size_hint_x: None
                do_default_tab: False

                TabbedPanelItem:
                    text: 'Basic'

                    MDScrollView:

                        BoxLayout:
                            size_hint_y: None
                            orientation: "vertical"
                            height: self.minimum_height

                            Label:
                                text_size: self.size
                                size: 0, 40
                                size_hint_y: None
                                text: ' White Balance'
                                font_size: '10pt'
                                halign: 'left'
                                valign: 'center'
 
                            ParamSlider:
                                id: slider_color_temperature
                                text: "Temperature"
                                min: 1000
                                max: 40000
                                value: 5600
                                step: 100
                                on_value: root.adjust_lv2('color_temperature')

                            ParamSlider:
                                id: slider_color_tint
                                text: "Tint"
                                min: -100
                                max: 100
                                value: 0
                                step: 1
                                on_value: root.adjust_lv2('color_tint')

                            HSeparator:
                                height: 30
 
                            Label:
                                text_size: self.size
                                size: 0, 40
                                size_hint_y: None
                                text: ' Tone'
                                font_size: '10pt'
                                halign: 'left'
                                valign: 'center'

                            ParamSlider:
                                id: slider_exposure
                                text: "Exposure"                            
                                min: -5.0
                                max: 5.0
                                value: 0.0
                                step: 0.1
                                on_value: root.adjust_lv2('exposure')

                            ParamSlider:
                                id: slider_contrast
                                text: "Contrast"
                                min: -100.0
                                max: 100.0
                                value: 0.0
                                step: 1.0
                                on_value: root.adjust_lv2('contrast')

                            HSeparator:
                                height: 20

                            ParamSlider:
                                id: slider_hilight
                                text: "Hilights"
                                min: -100.0
                                max: 100.0
                                value: 0.0
                                step: 1.0
                                on_value: root.adjust_lv2('tone')

                            ParamSlider:
                                id: slider_shadow
                                text: "Shadows"
                                min: -100.0
                                max: 100.0
                                value: 0.0
                                step: 1.0
                                on_value: root.adjust_lv2('tone')

                            ParamSlider:
                                id: slider_white
                                text: "Whites"
                                min: -100.0
                                max: 100.0
                                value: 0.0
                                step: 1.0
                                on_value: root.adjust_lv2('tone')

                            ParamSlider:
                                id: slider_black
                                text: "Blacks"
                                min: -100.0
                                max: 100.0
                                value: 0.0
                                step: 1.0
                                on_value: root.adjust_lv2('tone')

                            HSeparator:
                                height: 30
                            
                            Label:
                                text_size: self.size
                                size: 0, 40
                                size_hint_y: None
                                text: ' Precence'
                                font_size: '10pt'
                                halign: 'left'
                                valign: 'center'

                            ParamSlider:
                                id: slider_dehaze
                                text: "Dehaze"
                                min: -1.0
                                max: 1.0
                                value: 0.0
                                step: 0.01
                                on_value: root.adjust_lv2('dehaze')

                            HSeparator:
                                height: 20
                            
                            ParamSlider:
                                text: "Saturation"
                                id: slider_saturation
                                min: -1.0
                                max: 1.0
                                value: 0.0
                                step: 0.01
                                on_value: root.adjust_lv2('saturation')

                            ParamSlider:
                                text: "Vibrance"
                                id: slider_vibrance
                                min: -1.0
                                max: 1.0
                                value: 0.0
                                step: 0.01
                                on_value: root.adjust_lv2('saturation')

                            HSeparator:
                                height: 30
                            
                            Label:
                                text_size: self.size
                                size: 0, 40
                                size_hint_y: None
                                text: ' Tone Curve'
                                font_size: '10pt'
                                halign: 'left'
                                valign: 'center'

                            TabbedPanel:
                                size: 700, 700
                                size_hint: None, None
                                tab_width: 80
                                tab_height: 40
                                do_default_tab: False

                                TabbedPanelItem:
                                    text: 'All'

                                    CurveWidget:
                                        id: tonecurve
                                        start_y: 0.0
                                        end_y: 1.0
                                        on_curve: root.adjust_lv2('tonecurve')

                                TabbedPanelItem:
                                    text: 'Red'

                                    CurveWidget:
                                        id: tonecurve_red
                                        start_y: 0.0
                                        end_y: 1.0
                                        on_curve: root.adjust_lv2('tonecurve_red')

                                TabbedPanelItem:
                                    text: 'Green'

                                    CurveWidget:
                                        id: tonecurve_green
                                        start_y: 0.0
                                        end_y: 1.0
                                        on_curve: root.adjust_lv2('tonecurve_green')

                                TabbedPanelItem:
                                    text: 'Blue'

                                    CurveWidget:
                                        id: tonecurve_blue
                                        start_y: 0.0
                                        end_y: 1.0
                                        on_curve: root.adjust_lv2('tonecurve_blue')

                            HSeparator:
                                height: 30
                            
                            Label:
                                text_size: self.size
                                size: 0, 40
                                size_hint_y: None
                                text: ' Color Mixer'
                                font_size: '10pt'
                                halign: 'left'
                                valign: 'center'

                            TabbedPanel:
                                size: 700, 160
                                size_hint: None, None
                                tab_width: 120
                                tab_height: 40
                                do_default_tab: False

                                TabbedPanelItem:
                                    text: 'Red'

                                    BoxLayout:
                                        size_hint_y: None
                                        orientation: "vertical"
                                        height: self.minimum_height

                                        Label:
                                            text_size: self.size
                                            size: 0, 40
                                            size_hint_y: None
                                            text: ' Red'
                                            font_size: '10pt'
                                            halign: 'left'
                                            valign: 'center'
                                        ParamSlider:
                                            id: slider_hls_red_hue
                                            text: "Hue"
                                            min: -100.0
                                            max: 100.0
                                            value: 0.0
                                            step: 1.0
                                            on_value: root.adjust_lv2('hls_red')
                                        ParamSlider:
                                            id: slider_hls_red_sat
                                            text: "Saturation"
                                            min: -1.0
                                            max: 1.0
                                            value: 0.0
                                            step: 0.05
                                            on_value: root.adjust_lv2('hls_red')
                                        ParamSlider:
                                            id: slider_hls_red_lum
                                            text: "Luminance"
                                            min: -1.0
                                            max: 1.0
                                            value: 0.0
                                            step: 0.05
                                            on_value: root.adjust_lv2('hls_red')
                    
                                TabbedPanelItem:
                                    text: 'Orange'

                                    BoxLayout:
                                        size_hint_y: None
                                        orientation: "vertical"
                                        height: self.minimum_height
                                        Label:
                                            text_size: self.size
                                            size: 0, 40
                                            size_hint_y: None
                                            text: ' Orange'
                                            font_size: '10pt'
                                            halign: 'left'
                                            valign: 'center'
                                        ParamSlider:
                                            id: slider_hls_orange_hue
                                            text: "Hue"
                                            min: -100.0
                                            max: 100.0
                                            value: 0.0
                                            step: 1.0
                                            on_value: root.adjust_lv2('hls_orange')
                                        ParamSlider:
                                            id: slider_hls_orange_sat
                                            text: "Saturation"
                                            min: -1.0
                                            max: 1.0
                                            value: 0.0
                                            step: 0.05
                                            on_value: root.adjust_lv2('hls_orange')
                                        ParamSlider:
                                            id: slider_hls_orange_lum
                                            text: "Luminance"
                                            min: -1.0
                                            max: 1.0
                                            value: 0.0
                                            step: 0.05
                                            on_value: root.adjust_lv2('hls_orange')

                                TabbedPanelItem:
                                    text: 'Yellow'

                                    BoxLayout:
                                        size_hint_y: None
                                        orientation: "vertical"
                                        height: self.minimum_height
                                        Label:
                                            text_size: self.size
                                            size: 0, 40
                                            size_hint_y: None
                                            text: ' Yellow'
                                            font_size: '10pt'
                                            halign: 'left'
                                            valign: 'center'
                                        ParamSlider:
                                            id: slider_hls_yellow_hue
                                            text: "hue"
                                            min: -100.0
                                            max: 100.0
                                            value: 0.0
                                            step: 1.0
                                            on_value: root.adjust_lv2('hls_yellow')
                                        ParamSlider:
                                            id: slider_hls_yellow_sat
                                            text: "Saturation"
                                            min: -1.0
                                            max: 1.0
                                            value: 0.0
                                            step: 0.05
                                            on_value: root.adjust_lv2('hls_yellow')
                                        ParamSlider:
                                            id: slider_hls_yellow_lum
                                            text: "Luminance"
                                            min: -1.0
                                            max: 1.0
                                            value: 0.0
                                            step: 0.05
                                            on_value: root.adjust_lv2('hls_yellow')

                                TabbedPanelItem:
                                    text: 'Green'

                                    BoxLayout:
                                        size_hint_y: None
                                        orientation: "vertical"
                                        height: self.minimum_height
                                        Label:
                                            text_size: self.size
                                            size: 0, 40
                                            size_hint_y: None
                                            text: ' Green'
                                            font_size: '10pt'
                                            halign: 'left'
                                            valign: 'center'
                                        ParamSlider:
                                            id: slider_hls_green_hue
                                            text: "Hue"
                                            min: -100.0
                                            max: 100.0
                                            value: 0.0
                                            step: 1.0
                                            on_value: root.adjust_lv2('hls_green')
                                        ParamSlider:
                                            id: slider_hls_green_sat
                                            text: "Saturation"
                                            min: -1.0
                                            max: 1.0
                                            value: 0.0
                                            step: 0.05
                                            on_value: root.adjust_lv2('hls_green')
                                        ParamSlider:
                                            id: slider_hls_green_lum
                                            text: "Luminance"
                                            min: -1.0
                                            max: 1.0
                                            value: 0.0
                                            step: 0.05
                                            on_value: root.adjust_lv2('hls_green')

                                TabbedPanelItem:
                                    text: 'Cyan'

                                    BoxLayout:
                                        size_hint_y: None
                                        orientation: "vertical"
                                        height: self.minimum_height
                                        Label:
                                            text_size: self.size
                                            size: 0, 40
                                            size_hint_y: None
                                            text: ' Cyan'
                                            font_size: '10pt'
                                            halign: 'left'
                                            valign: 'center'
                                        ParamSlider:
                                            id: slider_hls_cyan_hue
                                            text: "Hue"
                                            min: -100.0
                                            max: 100.0
                                            value: 0.0
                                            step: 1.0
                                            on_value: root.adjust_lv2('hls_cyan')
                                        ParamSlider:
                                            id: slider_hls_cyan_sat
                                            text: "Saturation"
                                            min: -1.0
                                            max: 1.0
                                            value: 0.0
                                            step: 0.05
                                            on_value: root.adjust_lv2('hls_cyan')
                                        ParamSlider:
                                            id: slider_hls_cyan_lum
                                            text: "Luminance"
                                            min: -1.0
                                            max: 1.0
                                            value: 0.0
                                            step: 0.05
                                            on_value: root.adjust_lv2('hls_cyan')

                                TabbedPanelItem:
                                    text: 'Blue'

                                    BoxLayout:
                                        size_hint_y: None
                                        orientation: "vertical"
                                        height: self.minimum_height
                                        Label:
                                            text_size: self.size
                                            size: 0, 40
                                            size_hint_y: None
                                            text: ' Blue'
                                            font_size: '10pt'
                                            halign: 'left'
                                            valign: 'center'
                                        ParamSlider:
                                            id: slider_hls_blue_hue
                                            text: "Hue"
                                            min: -100.0
                                            max: 100.0
                                            value: 0.0
                                            step: 1.0
                                            on_value: root.adjust_lv2('hls_blue')
                                        ParamSlider:
                                            id: slider_hls_blue_sat
                                            text: "Saturation"
                                            min: -1.0
                                            max: 1.0
                                            value: 0.0
                                            step: 0.05
                                            on_value: root.adjust_lv2('hls_blue')
                                        ParamSlider:
                                            id: slider_hls_blue_lum
                                            text: "Luminance"
                                            min: -1.0
                                            max: 1.0
                                            value: 0.0
                                            step: 0.05
                                            on_value: root.adjust_lv2('hls_blue')

                                TabbedPanelItem:
                                    text: 'Purple'

                                    BoxLayout:
                                        size_hint_y: None
                                        orientation: "vertical"
                                        height: self.minimum_height
                                        Label:
                                            text_size: self.size
                                            size: 0, 40
                                            size_hint_y: None
                                            text: ' Purple'
                                            font_size: '10pt'
                                            halign: 'left'
                                            valign: 'center'
                                        ParamSlider:
                                            id: slider_hls_purple_hue
                                            text: "Hue"
                                            min: -100.0
                                            max: 100.0
                                            value: 0.0
                                            step: 1.0
                                            on_value: root.adjust_lv2('hls_purple')
                                        ParamSlider:
                                            id: slider_hls_purple_sat
                                            text: "Saturation"
                                            min: -1.0
                                            max: 1.0
                                            value: 0.0
                                            step: 0.05
                                            on_value: root.adjust_lv2('hls_purple')
                                        ParamSlider:
                                            id: slider_hls_purple_lum
                                            text: "Luminance"
                                            min: -1.0
                                            max: 1.0
                                            value: 0.0
                                            step: 0.05
                                            on_value: root.adjust_lv2('hls_purple')

                                TabbedPanelItem:
                                    text: 'Magenta'

                                    BoxLayout:
                                        size_hint_y: None
                                        orientation: "vertical"
                                        height: self.minimum_height
                                        Label:
                                            text_size: self.size
                                            size: 0, 40
                                            size_hint_y: None
                                            text: ' Magenta'
                                            font_size: '10pt'
                                            halign: 'left'
                                            valign: 'center'
                                        ParamSlider:
                                            id: slider_hls_magenta_hue
                                            text: "Hue"
                                            min: -100.0
                                            max: 100.0
                                            value: 0.0
                                            step: 1.0
                                            on_value: root.adjust_lv2('hls_magenta')
                                        ParamSlider:
                                            id: slider_hls_magenta_sat
                                            text: "Saturation"
                                            min: -1.0
                                            max: 1.0
                                            value: 0.0
                                            step: 0.05
                                            on_value: root.adjust_lv2('hls_magenta')
                                        ParamSlider:
                                            id: slider_hls_magenta_lum
                                            text: "Luminance"
                                            min: -1.0
                                            max: 1.0
                                            value: 0.0
                                            step: 0.05
                                            on_value: root.adjust_lv2('hls_magenta')

                TabbedPanelItem:
                    text: 'Curves'

                    MDScrollView:

                        BoxLayout:
                            size_hint_y: None
                            orientation: "vertical"
                            height: self.minimum_height

                            Label:
                                text_size: self.size
                                size: 0, 40
                                size_hint_y: None
                                text: ' Color Grading'
                                font_size: '10pt'
                                halign: 'left'
                                valign: 'center'

                            CurveWidget:
                                id: grading
                                size: 700, 700-120
                                size_hint: None, None
                                start_y: 0.0
                                end_y: 0.0
                                on_curve: root.adjust_lv2('grading')

                            ParamSlider:
                                id: slider_grading_hue
                                text: "Hue"
                                min: 0.0
                                max: 360.0
                                value: 0.0
                                step: 1.0
                                on_value: root.adjust_lv2('grading')

                            ParamSlider:
                                id: slider_grading_sat
                                text: "Saturation"
                                min: 0.0
                                max: 100.0
                                value: 0.0
                                step: 1.0
                                on_value: root.adjust_lv2('grading')

                            ParamSlider:
                                id: slider_grading_lum
                                text: "Luminance"
                                min: 0.0
                                max: 100.0
                                value: 0.0
                                step: 1.0
                                on_value: root.adjust_lv2('grading')

                            HSeparator:
                                height: 30
                            
                            Label:
                                text_size: self.size
                                size: 0, 40
                                size_hint_y: None
                                text: "Lum vs Lum"
                                font_size: '10pt'
                                halign: 'left'
                                valign: 'center'
                            CurveWidget:
                                id: LumvsLum
                                size: 700, 700-120
                                size_hint: None, None
                                start_y: 0.5
                                end_y: 0.5
                                on_curve: root.adjust_lv2('LumvsLum')

                            Label:
                                text_size: self.size
                                size: 0, 40
                                size_hint_y: None
                                font_size: '10pt'
                                halign: 'left'
                                valign: 'center'
                                text: "Hue vs Hue"
                            CurveWidget:
                                id: HuevsHue
                                size: 700, 700-120
                                size_hint: None, None
                                start_y: 0.5
                                end_y: 0.5
                                on_curve: root.adjust_lv2('HuevsHue')

                            Label:
                                text_size: self.size
                                size: 0, 40
                                size_hint_y: None
                                font_size: '10pt'
                                halign: 'left'
                                valign: 'center'
                                text: "Hue vs Sat"
                            CurveWidget:
                                id: HuevsSat
                                size: 700, 700-120
                                size_hint: None, None
                                start_y: 0.5
                                end_y: 0.5
                                on_curve: root.adjust_lv2('HuevsSat')

                            Label:
                                text_size: self.size
                                size: 0, 40
                                size_hint_y: None
                                font_size: '10pt'
                                halign: 'left'
                                valign: 'center'
                                text: "Hue vs Lum"
                            CurveWidget:
                                id: HuevsLum
                                size: 700, 700-120
                                size_hint: None, None
                                start_y: 0.5
                                end_y: 0.5
                                on_curve: root.adjust_lv2('HuevsLum')

                            Label:
                                text_size: self.size
                                size: 0, 40
                                size_hint_y: None
                                font_size: '10pt'
                                halign: 'left'
                                valign: 'center'
                                text: "Lum vs Sat"
                            CurveWidget:
                                id: LumvsSat
                                size: 700, 700-120
                                size_hint: None, None
                                start_y: 0.5
                                end_y: 0.5
                                on_curve: root.adjust_lv2('LumvsSat')

                            Label:
                                text_size: self.size
                                size: 0, 40
                                size_hint_y: None
                                font_size: '10pt'
                                halign: 'left'
                                valign: 'center'
                                text: "Sat vs Sat"
                            CurveWidget:
                                id: SatvsSat
                                size: 700, 700-120
                                size_hint: None, None
                                start_y: 0.5
                                end_y: 0.5
                                on_curve: root.adjust_lv2('SatvsSat')

                            Label:
                                text_size: self.size
                                size: 0, 40
                                size_hint_y: None
                                font_size: '10pt'
                                halign: 'left'
                                valign: 'center'
                                text: "Sat vs Lum"
                            CurveWidget:
                                id: SatvsLum
                                size: 700, 700-120
                                size_hint: None, None
                                start_y: 0.5
                                end_y: 0.5
                                on_curve: root.adjust_lv2('SatvsLum')                            

                TabbedPanelItem:
                    text: 'Extra'

                    MDScrollView:

                        MDBoxLayout:
                            size_hint_y: None
                            orientation: "vertical"
                            height: self.minimum_height

                            Label:
                                text_size: self.size
                                size: 0, 40
                                size_hint_y: None
                                text: ' Noise Reduction'
                                font_size: '10pt'
                                halign: 'left'
                                valign: 'center'

                            BoxLayout:
                                size: 0, 60
                                size_hint_y: None
                                orientation: 'horizontal'
                                ParamLabel:
                                    text: "AI"
                                VSpacer:
                                    size_hint_x: 5
                                Switch:
                                    size: 200, 0
                                    size_hint_x: None
                                    halign: 'right'
                                    id: toggle_noise_reduction
                                    on_active: root.adjust_lv2('noise_reduction')

                            HSeparator:
                                height: 30

                            Label:
                                text_size: self.size
                                size: 0, 40
                                size_hint_y: None
                                text: ' '
                                font_size: '10pt'
                                halign: 'left'
                                valign: 'center'

                            BoxLayout:
                                size: 0, 40
                                size_hint_y: None
                                orientation: 'horizontal'
                                Label:
                                    size_hint_x: 3
                                    text: "Inpaint"
                                ToggleButton:
                                    size_hint_x: 3
                                    id: toggle_inpaint
                                    on_state: root.adjust_lv0('inpaint')
                                Button:
                                    size_hint_x: 4
                                    id: button_inpaint
                                    on_press: root.adjust_lv0('inpaint')

                            BoxLayout:
                                size: 0, 60
                                size_hint_y: None
                                orientation: 'horizontal'
                                ParamLabel:
                                    text: "Defocus"
                                VSpacer:
                                    size_hint_x: 5
                                Switch:
                                    size: 200, 0
                                    size_hint_x: None
                                    halign: 'right'
                                    id: toggle_defocus
                                    on_active: root.adjust_lv2('defocus')

                            HSeparator:
                                height: 30

                            Label:
                                text_size: self.size
                                size: 0, 40
                                size_hint_y: None
                                text: ' Color'
                                font_size: '10pt'
                                halign: 'left'
                                valign: 'center'

                            BoxLayout:
                                size: 0, 60
                                size_hint_y: None
                                orientation: 'horizontal'
                                ParamLabel:
                                    text: "Color Correct"
                                VSpacer:
                                    size_hint_x: 5
                                Switch:
                                    size: 200, 0
                                    size_hint_x: None
                                    halign: 'right'
                                    id: switch_color_correct
                                    on_active: root.adjust_lv2('color_correct')

                            ParamSlider:
                                id: slider_density
                                text: "Density"
                                min: -100
                                max: 100
                                value: 0
                                step: 1
                                on_value: root.adjust_lv2('density')

                            ParamSlider:
                                id: slider_clear_color
                                text: "Clear Color"
                                min: -100
                                max: 100
                                value: 0
                                step: 1
                                on_value: root.adjust_lv2('clear_color')

                            HSeparator:
                                height: 30

                            Label:
                                text_size: self.size
                                size: 0, 40
                                size_hint_y: None
                                text: ' Filter'
                                font_size: '10pt'
                                halign: 'left'
                                valign: 'center'

                            ParamSlider:
                                id: slider_lowpass_filter
                                text: "Lowpass Filter"
                                min: 0
                                max: 100
                                value: 0
                                step: 2
                                on_value: root.adjust_lv1('lowpass_filter')

                            ParamSlider:
                                id: slider_highpass_filter
                                text: "Highpass Filter"
                                min: 0
                                max: 100
                                value: 0
                                step: 2
                                on_value: root.adjust_lv1('lowpass_filter')

                            ParamSlider:
                                id: slider_perlin_noise
                                text: "Perlin Noise"
                                min: 0
                                max: 10
                                value: 0
                                step: 1
                                on_value: root.adjust_lv1('perlin_noise')

                            ParamSlider:
                                id: slider_perlin_noise_opacity
                                text: "Perlin Opacity"
                                min: 0
                                max: 100
                                value: 100
                                step: 1
                                on_value: root.adjust_lv1('perlin_noise')

                            HSeparator:
                                height: 30

                            BoxLayout:
                                size_hint_y: None
                                orientation: 'horizontal'
                                ParamLabel:
                                    text: "LUT"
                                ToggleButton:
                                    size_hint_x: 7
                                    id: toggle_lut
                                    on_state: root.adjust_lv1('lut')

                            HSeparator:
                                height: 30

                            Label:
                                text_size: self.size
                                size: 0, 40
                                size_hint_y: None
                                text: ' Level'
                                font_size: '10pt'
                                halign: 'left'
                                valign: 'center'

                            ParamSlider:
                                id: slider_black_level
                                text: "black level"
                                min: 0
                                max: 255
                                value: 0
                                step: 1
                                on_value: root.adjust_lv2('level')

                            ParamSlider:
                                id: slider_mid_level
                                text: "mid level"
                                min: 0
                                max: 255
                                value: 127
                                step: 1
                                on_value: root.adjust_lv2('level')

                            ParamSlider:
                                id: slider_white_level
                                text: "white level"
                                min: 0
                                max: 255
                                value: 255
                                step: 1
                                on_value: root.adjust_lv2('level')

        ViewerWidget:
            id: viewer
            size_hint_y: None
            size: (0, dp(160))
            grid_width: dp(120)
            on_last_selected: root.on_select(self.last_selected.file_path, self.last_selected.exif_data)

<CurveWidget>:
