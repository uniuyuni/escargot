#:include param_slider.kv
#:include separator.kv
#:include spacer.kv
#:include viewer_widget.kv
#:include histogram_widget.kv
#:include metainfo.kv

MainWidget:   

<MainWidget>:
    
    BoxLayout:
        orientation: 'vertical'
        size: root.size

        BoxLayout:
            orientation: 'horizontal'
            size_hint_y: 9

            BoxLayout:
                orientation: 'vertical'
                size_hint_x: 3
                padding: dp(4)
                spacing: dp(4)

                HistogramWidget:
                    id: histogram
                    size_hint: None, None
                    size: dp(256), dp(100)

                MDScrollView:

                    BoxLayout:
                        size_hint_y: None
                        orientation: "vertical"
                        height: self.minimum_height

                        MetaInfo:
                            id: exif_file_name
                            key: "File Name"
                        MetaInfo:
                            id: exif_create_date
                            key: "Create Date"
                        MetaInfo:
                            id: exif_image_size
                            key: "Image Size"
                        MetaInfo:
                            id: exif_iso_speed
                            key: "ISO Speed"
                        MetaInfo:
                            id: exif_aperture
                            key: "Aperture"
                        MetaInfo:
                            id: exif_shutter_speed
                            key: "Shutter Speed"
                        MetaInfo:
                            id: exif_brightness
                            key: "Brightness"
                        MetaInfo:
                            id: exif_flash
                            key: "Flash"
                        MetaInfo:
                            id: exif_white_balance
                            key: "White Balance"
                        MetaInfo:
                            id: exif_focal_length
                            key: "Focal Length"
                        MetaInfo:
                            id: exif_exposure_program
                            key: "Exposure Program"
                        MetaInfo:
                            id: exif_make
                            key: "Make"
                        MetaInfo:
                            id: exif_model
                            key: "Model"
                        MetaInfo:
                            id: exif_lens_model
                            key: "Lens Model"
                        MetaInfo:
                            id: exif_software
                            key: "Software"
                            
            FloatLayout:
                id: preview_widget
                size_hint_x: 7
                Image:
                    pos_hint: {'x':0, 'top': 1}
                    id: preview
                    on_touch_down: root.on_image_touch_down(args[1])
                    on_touch_move: root.on_image_touch_move(args[1])
                    on_touch_up: root.on_image_touch_up(args[1])

                MaskEditor2:
                    pos_hint: {'x':0, 'top': 1}
                    id: mask_editor2
                    canvas:
                        Color:
                            rgba: 0, 0, 0, 0
                        Rectangle:
                            size: self.size
                            pos: self.pos

            TabbedPanel:
                id: effects
                size: 700, 0
                size_hint_x: None
                do_default_tab: False

                TabbedPanelItem:
                    text: 'Basic'

                    MDScrollView:

                        BoxLayout:
                            size_hint_y: None
                            orientation: "vertical"
                            height: self.minimum_height

                            Label:
                                text_size: self.size
                                size: 0, 40
                                size_hint_y: None
                                text: ' White Balance'
                                font_size: '10pt'
                                halign: 'left'
                                valign: 'center'
 
                            ParamSlider:
                                id: slider_color_temperature
                                text: "Temperature"
                                min: 1000
                                max: 14000
                                value: 6400
                                step: 100
                                on_slider: root.apply_effects_lv(2, 'color_temperature')

                            ParamSlider:
                                id: slider_color_tint
                                text: "Tint"
                                min: -100
                                max: 100
                                value: 0
                                step: 1
                                on_slider: root.apply_effects_lv(2, 'color_temperature')

                            HSeparator:
                                height: 30
 
                            Label:
                                text_size: self.size
                                size: 0, 40
                                size_hint_y: None
                                text: ' Tone'
                                font_size: '10pt'
                                halign: 'left'
                                valign: 'center'

                            ParamSlider:
                                id: slider_exposure
                                text: "Exposure"                            
                                min: -4.0
                                max: 4.0
                                value: 0.0
                                step: 0.05
                                for_float: True
                                on_slider: root.apply_effects_lv(2, 'exposure')

                            ParamSlider:
                                id: slider_contrast
                                text: "Contrast"
                                min: -100
                                max: 100
                                value: 0
                                step: 1
                                on_slider: root.apply_effects_lv(2, 'contrast')

                            ParamSlider:
                                id: slider_midtone
                                text: "Midtone"                            
                                min: -100
                                max: 100
                                value: 0
                                step: 1
                                for_float: True
                                on_slider: root.apply_effects_lv(2, 'midtone')

                            HSeparator:
                                height: 20

                            ParamSlider:
                                id: slider_hilight
                                text: "Hilights"
                                min: -100
                                max: 100
                                value: 0
                                step: 1
                                on_slider: root.apply_effects_lv(2, 'tone')

                            ParamSlider:
                                id: slider_shadow
                                text: "Shadows"
                                min: -100
                                max: 100
                                value: 0
                                step: 1
                                on_slider: root.apply_effects_lv(2, 'tone')

                            ParamSlider:
                                id: slider_white
                                text: "Whites"
                                min: -100
                                max: 100
                                value: 0
                                step: 1
                                on_slider: root.apply_effects_lv(2, 'tone')

                            ParamSlider:
                                id: slider_black
                                text: "Blacks"
                                min: -100
                                max: 100
                                value: 0
                                step: 1
                                on_slider: root.apply_effects_lv(2, 'tone')

                            HSeparator:
                                height: 30
                            
                            Label:
                                text_size: self.size
                                size: 0, 40
                                size_hint_y: None
                                text: ' Precence'
                                font_size: '10pt'
                                halign: 'left'
                                valign: 'center'

                            ParamSlider:
                                id: slider_dehaze
                                text: "Dehaze"
                                min: -1.0
                                max: 1.0
                                value: 0.0
                                step: 0.01
                                for_float: True
                                on_slider: root.apply_effects_lv(2, 'dehaze')

                            HSeparator:
                                height: 20
                            
                            ParamSlider:
                                text: "Saturation"
                                id: slider_saturation
                                min: -100
                                max: 100
                                value: 0
                                step: 1
                                on_slider: root.apply_effects_lv(2, 'saturation')

                            ParamSlider:
                                text: "Vibrance"
                                id: slider_vibrance
                                min: -100
                                max: 100
                                value: 0
                                step: 1
                                on_slider: root.apply_effects_lv(2, 'saturation')

                            HSeparator:
                                height: 30
                                                        
                            Label:
                                text_size: self.size
                                size: 0, 40
                                size_hint_y: None
                                text: ' Color Mixer'
                                font_size: '10pt'
                                halign: 'left'
                                valign: 'center'

                            TabbedPanel:
                                size: 700, 160
                                size_hint: None, None
                                tab_width: 120
                                tab_height: 40
                                do_default_tab: False

                                TabbedPanelItem:
                                    text: 'Red'

                                    BoxLayout:
                                        size_hint_y: None
                                        orientation: "vertical"
                                        height: self.minimum_height

                                        Label:
                                            text_size: self.size
                                            size: 0, 40
                                            size_hint_y: None
                                            text: ' Red'
                                            font_size: '10pt'
                                            halign: 'left'
                                            valign: 'center'
                                        ParamSlider:
                                            id: slider_hls_red_hue
                                            text: "Hue"
                                            min: -100.0
                                            max: 100.0
                                            value: 0.0
                                            step: 1.0
                                            on_slider: root.apply_effects_lv(2, 'hls_red')
                                        ParamSlider:
                                            id: slider_hls_red_sat
                                            text: "Saturation"
                                            min: -1.0
                                            max: 1.0
                                            value: 0.0
                                            step: 0.05
                                            on_slider: root.apply_effects_lv(2, 'hls_red')
                                        ParamSlider:
                                            id: slider_hls_red_lum
                                            text: "Luminance"
                                            min: -1.0
                                            max: 1.0
                                            value: 0.0
                                            step: 0.05
                                            on_slider: root.apply_effects_lv(2, 'hls_red')
                    
                                TabbedPanelItem:
                                    text: 'Orange'

                                    BoxLayout:
                                        size_hint_y: None
                                        orientation: "vertical"
                                        height: self.minimum_height
                                        Label:
                                            text_size: self.size
                                            size: 0, 40
                                            size_hint_y: None
                                            text: ' Orange'
                                            font_size: '10pt'
                                            halign: 'left'
                                            valign: 'center'
                                        ParamSlider:
                                            id: slider_hls_orange_hue
                                            text: "Hue"
                                            min: -100.0
                                            max: 100.0
                                            value: 0.0
                                            step: 1.0
                                            on_slider: root.apply_effects_lv(2, 'hls_orange')
                                        ParamSlider:
                                            id: slider_hls_orange_sat
                                            text: "Saturation"
                                            min: -1.0
                                            max: 1.0
                                            value: 0.0
                                            step: 0.05
                                            on_slider: root.apply_effects_lv(2, 'hls_orange')
                                        ParamSlider:
                                            id: slider_hls_orange_lum
                                            text: "Luminance"
                                            min: -1.0
                                            max: 1.0
                                            value: 0.0
                                            step: 0.05
                                            on_slider: root.apply_effects_lv(2, 'hls_orange')

                                TabbedPanelItem:
                                    text: 'Yellow'

                                    BoxLayout:
                                        size_hint_y: None
                                        orientation: "vertical"
                                        height: self.minimum_height
                                        Label:
                                            text_size: self.size
                                            size: 0, 40
                                            size_hint_y: None
                                            text: ' Yellow'
                                            font_size: '10pt'
                                            halign: 'left'
                                            valign: 'center'
                                        ParamSlider:
                                            id: slider_hls_yellow_hue
                                            text: "hue"
                                            min: -100.0
                                            max: 100.0
                                            value: 0.0
                                            step: 1.0
                                            on_slider: root.apply_effects_lv(2, 'hls_yellow')
                                        ParamSlider:
                                            id: slider_hls_yellow_sat
                                            text: "Saturation"
                                            min: -1.0
                                            max: 1.0
                                            value: 0.0
                                            step: 0.05
                                            on_slider: root.apply_effects_lv(2, 'hls_yellow')
                                        ParamSlider:
                                            id: slider_hls_yellow_lum
                                            text: "Luminance"
                                            min: -1.0
                                            max: 1.0
                                            value: 0.0
                                            step: 0.05
                                            on_slider: root.apply_effects_lv(2, 'hls_yellow')

                                TabbedPanelItem:
                                    text: 'Green'

                                    BoxLayout:
                                        size_hint_y: None
                                        orientation: "vertical"
                                        height: self.minimum_height
                                        Label:
                                            text_size: self.size
                                            size: 0, 40
                                            size_hint_y: None
                                            text: ' Green'
                                            font_size: '10pt'
                                            halign: 'left'
                                            valign: 'center'
                                        ParamSlider:
                                            id: slider_hls_green_hue
                                            text: "Hue"
                                            min: -100.0
                                            max: 100.0
                                            value: 0.0
                                            step: 1.0
                                            on_slider: root.apply_effects_lv(2, 'hls_green')
                                        ParamSlider:
                                            id: slider_hls_green_sat
                                            text: "Saturation"
                                            min: -1.0
                                            max: 1.0
                                            value: 0.0
                                            step: 0.05
                                            on_slider: root.apply_effects_lv(2, 'hls_green')
                                        ParamSlider:
                                            id: slider_hls_green_lum
                                            text: "Luminance"
                                            min: -1.0
                                            max: 1.0
                                            value: 0.0
                                            step: 0.05
                                            on_slider: root.apply_effects_lv(2, 'hls_green')

                                TabbedPanelItem:
                                    text: 'Cyan'

                                    BoxLayout:
                                        size_hint_y: None
                                        orientation: "vertical"
                                        height: self.minimum_height
                                        Label:
                                            text_size: self.size
                                            size: 0, 40
                                            size_hint_y: None
                                            text: ' Cyan'
                                            font_size: '10pt'
                                            halign: 'left'
                                            valign: 'center'
                                        ParamSlider:
                                            id: slider_hls_cyan_hue
                                            text: "Hue"
                                            min: -100.0
                                            max: 100.0
                                            value: 0.0
                                            step: 1.0
                                            on_slider: root.apply_effects_lv(2, 'hls_cyan')
                                        ParamSlider:
                                            id: slider_hls_cyan_sat
                                            text: "Saturation"
                                            min: -1.0
                                            max: 1.0
                                            value: 0.0
                                            step: 0.05
                                            on_slider: root.apply_effects_lv(2, 'hls_cyan')
                                        ParamSlider:
                                            id: slider_hls_cyan_lum
                                            text: "Luminance"
                                            min: -1.0
                                            max: 1.0
                                            value: 0.0
                                            step: 0.05
                                            on_slider: root.apply_effects_lv(2, 'hls_cyan')

                                TabbedPanelItem:
                                    text: 'Blue'

                                    BoxLayout:
                                        size_hint_y: None
                                        orientation: "vertical"
                                        height: self.minimum_height
                                        Label:
                                            text_size: self.size
                                            size: 0, 40
                                            size_hint_y: None
                                            text: ' Blue'
                                            font_size: '10pt'
                                            halign: 'left'
                                            valign: 'center'
                                        ParamSlider:
                                            id: slider_hls_blue_hue
                                            text: "Hue"
                                            min: -100.0
                                            max: 100.0
                                            value: 0.0
                                            step: 1.0
                                            on_slider: root.apply_effects_lv(2, 'hls_blue')
                                        ParamSlider:
                                            id: slider_hls_blue_sat
                                            text: "Saturation"
                                            min: -1.0
                                            max: 1.0
                                            value: 0.0
                                            step: 0.05
                                            on_slider: root.apply_effects_lv(2, 'hls_blue')
                                        ParamSlider:
                                            id: slider_hls_blue_lum
                                            text: "Luminance"
                                            min: -1.0
                                            max: 1.0
                                            value: 0.0
                                            step: 0.05
                                            on_slider: root.apply_effects_lv(2, 'hls_blue')

                                TabbedPanelItem:
                                    text: 'Purple'

                                    BoxLayout:
                                        size_hint_y: None
                                        orientation: "vertical"
                                        height: self.minimum_height
                                        Label:
                                            text_size: self.size
                                            size: 0, 40
                                            size_hint_y: None
                                            text: ' Purple'
                                            font_size: '10pt'
                                            halign: 'left'
                                            valign: 'center'
                                        ParamSlider:
                                            id: slider_hls_purple_hue
                                            text: "Hue"
                                            min: -100.0
                                            max: 100.0
                                            value: 0.0
                                            step: 1.0
                                            on_slider: root.apply_effects_lv(2, 'hls_purple')
                                        ParamSlider:
                                            id: slider_hls_purple_sat
                                            text: "Saturation"
                                            min: -1.0
                                            max: 1.0
                                            value: 0.0
                                            step: 0.05
                                            on_slider: root.apply_effects_lv(2, 'hls_purple')
                                        ParamSlider:
                                            id: slider_hls_purple_lum
                                            text: "Luminance"
                                            min: -1.0
                                            max: 1.0
                                            value: 0.0
                                            step: 0.05
                                            on_slider: root.apply_effects_lv(2, 'hls_purple')

                                TabbedPanelItem:
                                    text: 'Magenta'

                                    BoxLayout:
                                        size_hint_y: None
                                        orientation: "vertical"
                                        height: self.minimum_height
                                        Label:
                                            text_size: self.size
                                            size: 0, 40
                                            size_hint_y: None
                                            text: ' Magenta'
                                            font_size: '10pt'
                                            halign: 'left'
                                            valign: 'center'
                                        ParamSlider:
                                            id: slider_hls_magenta_hue
                                            text: "Hue"
                                            min: -100.0
                                            max: 100.0
                                            value: 0.0
                                            step: 1.0
                                            on_slider: root.apply_effects_lv(2, 'hls_magenta')
                                        ParamSlider:
                                            id: slider_hls_magenta_sat
                                            text: "Saturation"
                                            min: -1.0
                                            max: 1.0
                                            value: 0.0
                                            step: 0.05
                                            on_slider: root.apply_effects_lv(2, 'hls_magenta')
                                        ParamSlider:
                                            id: slider_hls_magenta_lum
                                            text: "Luminance"
                                            min: -1.0
                                            max: 1.0
                                            value: 0.0
                                            step: 0.05
                                            on_slider: root.apply_effects_lv(2, 'hls_magenta')

                TabbedPanelItem:
                    text: 'Curves'

                    MDScrollView:

                        BoxLayout:
                            size_hint_y: None
                            orientation: "vertical"
                            height: self.minimum_height

                            Label:
                                text_size: self.size
                                size: 0, 40
                                size_hint_y: None
                                text: ' Tone Curve'
                                font_size: '10pt'
                                halign: 'left'
                                valign: 'center'

                            TabbedPanel:
                                size: 700, 700
                                size_hint: None, None
                                tab_width: 80
                                tab_height: 40
                                do_default_tab: False

                                TabbedPanelItem:
                                    text: 'All'

                                    CurveWidget:
                                        id: tonecurve
                                        start_y: 0.0
                                        end_y: 1.0
                                        on_curve: root.apply_effects_lv(2, 'tonecurve')

                                TabbedPanelItem:
                                    text: 'Red'

                                    CurveWidget:
                                        id: tonecurve_red
                                        start_y: 0.0
                                        end_y: 1.0
                                        on_curve: root.apply_effects_lv(2, 'tonecurve_red')

                                TabbedPanelItem:
                                    text: 'Green'

                                    CurveWidget:
                                        id: tonecurve_green
                                        start_y: 0.0
                                        end_y: 1.0
                                        on_curve: root.apply_effects_lv(2, 'tonecurve_green')

                                TabbedPanelItem:
                                    text: 'Blue'

                                    CurveWidget:
                                        id: tonecurve_blue
                                        start_y: 0.0
                                        end_y: 1.0
                                        on_curve: root.apply_effects_lv(2, 'tonecurve_blue')

                            HSeparator:
                                height: 30
                                
                            Label:
                                text_size: self.size
                                size: 0, 40
                                size_hint_y: None
                                text: ' Color Grading'
                                font_size: '10pt'
                                halign: 'left'
                                valign: 'center'

                            CurveWidget:
                                id: grading
                                size: 700, 700-120
                                size_hint: None, None
                                start_y: 0.0
                                end_y: 0.0
                                on_curve: root.apply_effects_lv(2, 'grading')

                            ParamSlider:
                                id: slider_grading_hue
                                text: "Hue"
                                min: 0.0
                                max: 360.0
                                value: 0.0
                                step: 1.0
                                on_slider: root.apply_effects_lv(2, 'grading')

                            ParamSlider:
                                id: slider_grading_sat
                                text: "Saturation"
                                min: 0.0
                                max: 100.0
                                value: 0.0
                                step: 1.0
                                on_slider: root.apply_effects_lv(2, 'grading')

                            ParamSlider:
                                id: slider_grading_lum
                                text: "Luminance"
                                min: 0.0
                                max: 100.0
                                value: 0.0
                                step: 1.0
                                on_slider: root.apply_effects_lv(2, 'grading')

                            HSeparator:
                                height: 30
                            
                            Label:
                                text_size: self.size
                                size: 0, 40
                                size_hint_y: None
                                text: "Lum vs Lum"
                                font_size: '10pt'
                                halign: 'left'
                                valign: 'center'
                            CurveWidget:
                                id: LumvsLum
                                size: 700, 700-120
                                size_hint: None, None
                                start_y: 0.5
                                end_y: 0.5
                                on_curve: root.apply_effects_lv(2, 'LumvsLum')

                            Label:
                                text_size: self.size
                                size: 0, 40
                                size_hint_y: None
                                font_size: '10pt'
                                halign: 'left'
                                valign: 'center'
                                text: "Hue vs Hue"
                            CurveWidget:
                                id: HuevsHue
                                size: 700, 700-120
                                size_hint: None, None
                                start_y: 0.5
                                end_y: 0.5
                                on_curve: root.apply_effects_lv(2, 'HuevsHue')

                            Label:
                                text_size: self.size
                                size: 0, 40
                                size_hint_y: None
                                font_size: '10pt'
                                halign: 'left'
                                valign: 'center'
                                text: "Hue vs Sat"
                            CurveWidget:
                                id: HuevsSat
                                size: 700, 700-120
                                size_hint: None, None
                                start_y: 0.5
                                end_y: 0.5
                                on_curve: root.apply_effects_lv(2, 'HuevsSat')

                            Label:
                                text_size: self.size
                                size: 0, 40
                                size_hint_y: None
                                font_size: '10pt'
                                halign: 'left'
                                valign: 'center'
                                text: "Hue vs Lum"
                            CurveWidget:
                                id: HuevsLum
                                size: 700, 700-120
                                size_hint: None, None
                                start_y: 0.5
                                end_y: 0.5
                                on_curve: root.apply_effects_lv(2, 'HuevsLum')

                            Label:
                                text_size: self.size
                                size: 0, 40
                                size_hint_y: None
                                font_size: '10pt'
                                halign: 'left'
                                valign: 'center'
                                text: "Lum vs Sat"
                            CurveWidget:
                                id: LumvsSat
                                size: 700, 700-120
                                size_hint: None, None
                                start_y: 0.5
                                end_y: 0.5
                                on_curve: root.apply_effects_lv(2, 'LumvsSat')

                            Label:
                                text_size: self.size
                                size: 0, 40
                                size_hint_y: None
                                font_size: '10pt'
                                halign: 'left'
                                valign: 'center'
                                text: "Sat vs Sat"
                            CurveWidget:
                                id: SatvsSat
                                size: 700, 700-120
                                size_hint: None, None
                                start_y: 0.5
                                end_y: 0.5
                                on_curve: root.apply_effects_lv(2, 'SatvsSat')

                            Label:
                                text_size: self.size
                                size: 0, 40
                                size_hint_y: None
                                font_size: '10pt'
                                halign: 'left'
                                valign: 'center'
                                text: "Sat vs Lum"
                            CurveWidget:
                                id: SatvsLum
                                size: 700, 700-120
                                size_hint: None, None
                                start_y: 0.5
                                end_y: 0.5
                                on_curve: root.apply_effects_lv(2, 'SatvsLum')                            

                TabbedPanelItem:
                    text: 'Extra'

                    MDScrollView:

                        MDBoxLayout:
                            size_hint_y: None
                            orientation: "vertical"
                            height: self.minimum_height

                            Label:
                                text_size: self.size
                                size: 0, 40
                                size_hint_y: None
                                text: ' Noise Reduction'
                                font_size: '10pt'
                                halign: 'left'
                                valign: 'center'

                            BoxLayout:
                                size: 0, 60
                                size_hint_y: None
                                orientation: 'horizontal'
                                ParamLabel:
                                    text: "AI"
                                VSpacer:
                                    size_hint_x: 5
                                MDChip:
                                    type: 'filter'
                                    pos_hint: {"center_x": .5, "center_y": .5}
                                    size: 100, 40
                                    size_hint: None, None
                                    id: switch_ai_noise_reduction
                                    radius: 40
                                    line_color: 'grey'
                                    on_active: root.apply_effects_lv(1, 'ai_noise_reduction')

                                    MDChipText:
                                        text: "AI"
                                        font_size: '9pt'
                                        color: 'b0b0b0' 


                            ParamSlider:
                                id: slider_nlm_noise_reduction
                                text: "NLM"
                                min: 0
                                max: 100
                                value: 0
                                step: 1
                                on_slider: root.apply_effects_lv(1, 'nlm_noise_reduction')

                            HSeparator:
                                height: 30

                            Label:
                                text_size: self.size
                                size: 0, 40
                                size_hint_y: None
                                text: ' Details'
                                font_size: '10pt'
                                halign: 'left'
                                valign: 'center'

                            BoxLayout:
                                size: 0, 60
                                size_hint_y: None
                                orientation: 'horizontal'
                                ParamLabel:
                                    text: "Inpaint"
                                VSpacer:
                                    size_hint_x: 5
                                MDChip:
                                    type: 'filter'
                                    pos_hint: {"center_x": .5, "center_y": .5}
                                    size: 100, 40
                                    size_hint: None, None
                                    id: switch_inpaint
                                    radius: 40
                                    line_color: 'grey'
                                    on_active: root.apply_effects_lv(0, 'inpaint')

                                    MDChipText:
                                        text: "Prepare"
                                        font_size: '9pt'
                                        color: 'b0b0b0'

                                MDRoundFlatButton:
                                    pos_hint: {"center_x": .5, "center_y": .5}
                                    size: 100, 40
                                    size_hint: None, None
                                    id: button_inpaint_predict
                                    text: "Predict"
                                    on_press: root.apply_effects_lv(0, 'inpaint')

                            BoxLayout:
                                size: 0, 60
                                size_hint_y: None
                                orientation: 'horizontal'
                                ParamLabel:
                                    text: "Defocus"
                                VSpacer:
                                    size_hint_x: 5
                                MDChip:
                                    type: 'filter'
                                    pos_hint: {"center_x": .5, "center_y": .5}
                                    size: 100, 40
                                    size_hint: None, None
                                    id: switch_defocus
                                    radius: 40
                                    line_color: 'grey'
                                    on_active: root.apply_effects_lv(1, 'defocus')

                                    MDChipText:
                                        text: "AI"
                                        font_size: '9pt'
                                        color: 'b0b0b0' 

                            ParamSlider:
                                id: slider_deblur_filter
                                text: "Deblur"
                                min: 0
                                max: 50
                                value: 0
                                step: 1
                                on_slider: root.apply_effects_lv(1, 'deblur_filter')
                                
                            HSeparator:
                                height: 30

                            Label:
                                text_size: self.size
                                size: 0, 40
                                size_hint_y: None
                                text: ' Color'
                                font_size: '10pt'
                                halign: 'left'
                                valign: 'center'

                            BoxLayout:
                                size: 0, 60
                                size_hint_y: None
                                orientation: 'horizontal'
                                ParamLabel:
                                    text: "Color Correct"
                                VSpacer:
                                    size_hint_x: 5
                                MDChip:
                                    type: 'filter'
                                    pos_hint: {"center_x": .5, "center_y": .5}
                                    size: 100, 40
                                    size_hint: None, None
                                    id: switch_color_correct
                                    radius: 40
                                    line_color: 'grey'
                                    on_active: root.apply_effects_lv(2, 'color_correct')

                                    MDChipText:
                                        text: "AI"
                                        font_size: '9pt'
                                        color: 'b0b0b0' 

                            ParamSlider:
                                id: slider_density
                                text: "Density"
                                min: -100
                                max: 100
                                value: 0
                                step: 1
                                on_slider: root.apply_effects_lv(2, 'density')

                            ParamSlider:
                                id: slider_clear_color
                                text: "Clear Color"
                                min: -100
                                max: 100
                                value: 0
                                step: 1
                                on_slider: root.apply_effects_lv(2, 'clear_color')

                            HSeparator:
                                height: 30

                            Label:
                                text_size: self.size
                                size: 0, 40
                                size_hint_y: None
                                text: ' Filter'
                                font_size: '10pt'
                                halign: 'left'
                                valign: 'center'

                            ParamSlider:
                                id: slider_lowpass_filter
                                text: "Lowpass Filter"
                                min: 0
                                max: 100
                                value: 0
                                step: 2
                                on_slider: root.apply_effects_lv(1, 'lowpass_filter')

                            ParamSlider:
                                id: slider_highpass_filter
                                text: "Highpass Filter"
                                min: 0
                                max: 100
                                value: 0
                                step: 2
                                on_slider: root.apply_effects_lv(1, 'lowpass_filter')

                            ParamSlider:
                                id: slider_perlin_noise
                                text: "Perlin Noise"
                                min: 0
                                max: 10
                                value: 0
                                step: 1
                                on_slider: root.apply_effects_lv(1, 'perlin_noise')

                            ParamSlider:
                                id: slider_perlin_noise_opacity
                                text: "Perlin Opacity"
                                min: 0
                                max: 100
                                value: 100
                                step: 1
                                on_slider: root.apply_effects_lv(1, 'perlin_noise')

                            HSeparator:
                                height: 30

                            BoxLayout:
                                size_hint_y: None
                                orientation: 'horizontal'
                                ParamLabel:
                                    text: "LUT"
                                ToggleButton:
                                    size_hint_x: 7
                                    id: toggle_lut
                                    on_state: root.apply_effects_lv(1, 'lut')

                            HSeparator:
                                height: 30

                            Label:
                                text_size: self.size
                                size: 0, 40
                                size_hint_y: None
                                text: ' Level'
                                font_size: '10pt'
                                halign: 'left'
                                valign: 'center'

                            ParamSlider:
                                id: slider_black_level
                                text: "Black Level"
                                min: 0
                                max: 253
                                value: 0
                                step: 1
                                on_slider: root.apply_effects_lv(2, 'level')

                            ParamSlider:
                                id: slider_mid_level
                                text: "Mid Level"
                                min: 1
                                max: 254
                                value: 127
                                step: 1
                                on_slider: root.apply_effects_lv(2, 'level')

                            ParamSlider:
                                id: slider_white_level
                                text: "White Level"
                                min: 2
                                max: 255
                                value: 255
                                step: 1
                                on_slider: root.apply_effects_lv(2, 'level')

                            HSeparator:
                                height: 30

                            Label:
                                text_size: self.size
                                size: 0, 40
                                size_hint_y: None
                                text: ' Glow Effect'
                                font_size: '10pt'
                                halign: 'left'
                                valign: 'center'

                            ParamSlider:
                                id: slider_glow_black
                                text: "Black"
                                min: 0
                                max: 126
                                value: 0
                                step: 1
                                on_slider: root.apply_effects_lv(1, 'glow')

                            ParamSlider:
                                id: slider_glow_gauss
                                text: "Gauss"
                                min: 0
                                max: 100
                                value: 0
                                step: 2
                                on_slider: root.apply_effects_lv(1, 'glow')

                            ParamSlider:
                                id: slider_glow_opacity
                                text: "Opacity"
                                min: 0
                                max: 100
                                value: 0
                                step: 1
                                on_slider: root.apply_effects_lv(1, 'glow')

                TabbedPanelItem:
                    text: 'Geometry'

                    MDScrollView:

                        MDBoxLayout:
                            size_hint_y: None
                            orientation: "vertical"
                            height: self.minimum_height

                            Label:
                                text_size: self.size
                                size: 0, 40
                                size_hint_y: None
                                text: ' Rotation'
                                font_size: '10pt'
                                halign: 'left'
                                valign: 'center'

                            ParamSlider:
                                id: slider_rotation
                                text: "Angle"
                                min: -45.0
                                max: 45.0
                                value: 0
                                step: 0.1
                                on_slider: root.apply_effects_lv(0, 'rotation')

                            HSeparator:
                                height: 30

        ViewerWidget:
            id: viewer
            size_hint_y: None
            size: (0, dp(160))
            grid_width: dp(120)
            on_last_selected: root.on_select(self.last_selected.file_path, self.last_selected.exif_data)

<CurveWidget>:
